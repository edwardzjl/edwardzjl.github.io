<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://edwardzjl.github.io</id>
    <title>Edwardzjl Blog</title>
    <updated>2025-01-23T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://edwardzjl.github.io"/>
    <subtitle>Edwardzjl Blog</subtitle>
    <icon>https://edwardzjl.github.io/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[Distributed SFT Part 1: Starting Locally]]></title>
        <id>https://edwardzjl.github.io/distributed-sft-part-1</id>
        <link href="https://edwardzjl.github.io/distributed-sft-part-1"/>
        <updated>2025-01-23T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Introduction]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="https://edwardzjl.github.io/distributed-sft-part-1#introduction" class="hash-link" aria-label="Introductionçš„ç›´æ¥é“¾æ¥" title="Introductionçš„ç›´æ¥é“¾æ¥">â€‹</a></h2>
<p>Welcome to this series of articles documenting the lessons I learned during my first attempt at running distributed supervised fine-tuning (SFT) tasks using <a href="https://github.com/huggingface/trl" target="_blank" rel="noopener noreferrer">trl</a> and <a href="https://github.com/microsoft/DeepSpeed" target="_blank" rel="noopener noreferrer">DeepSpeed</a>.</p>
<p>This series will walk you through my journey, starting with a simple local experiment and progressively scaling up to a distributed environment. The three parts of this series are:</p>
<ul>
<li>
<p><strong>Part 1: The Local Experiment</strong> -- I will show you how I ran my very first local SFT experiment, following the official <a href="https://huggingface.co/docs/trl/sft_trainer" target="_blank" rel="noopener noreferrer">trl documentation</a>.</p>
</li>
<li>
<p><strong>Part 2: Multi GPU</strong> -- We will leverage <strong>single-machine, multi-GPU</strong> parallel training to complete a full SFT task in our local environment.</p>
</li>
<li>
<p><strong>Part 3: Multi Machine</strong> -- We'll take things a step further by submitting the same training task to a Kubernetes cluster, utilizing <strong>multi-machine, multi-GPU</strong> training with <a href="https://github.com/kubeflow/training-operator" target="_blank" rel="noopener noreferrer">Kubeflow's Training Operator</a>.</p>
</li>
</ul>
<p>A quick note about myself: I'm a software development engineer who is fairly new to the field of deep learning. If these articles seem too basic for you, I appreciate your patience as I navigate this learning journey.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="https://edwardzjl.github.io/distributed-sft-part-1#prerequisites" class="hash-link" aria-label="Prerequisitesçš„ç›´æ¥é“¾æ¥" title="Prerequisitesçš„ç›´æ¥é“¾æ¥">â€‹</a></h2>
<p>To follow this tutorial, you'll need a machine with at least one NVIDIA GPU. I ran the experiment on a V100 without encountering any memory issues. If your GPU has less than 32GB of VRAM, you may need to reduce the <code>per_device_train_batch_size</code> or consider using truncation (although this is not recommended) to prevent CUDA out-of-memory (OOM) errors.</p>
<p>You'll also need the following dependencies:</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">datasets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">transformers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">torch</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="training">Training<a href="https://edwardzjl.github.io/distributed-sft-part-1#training" class="hash-link" aria-label="Trainingçš„ç›´æ¥é“¾æ¥" title="Trainingçš„ç›´æ¥é“¾æ¥">â€‹</a></h2>
<p>The <code>trl</code> library offers some excellent example training scripts, and we'll start with this one: <a href="https://github.com/huggingface/trl/blob/main/trl/scripts/sft.py" target="_blank" rel="noopener noreferrer">https://github.com/huggingface/trl/blob/main/trl/scripts/sft.py</a></p>
<p>Copy the script to your development machine (or notebook), select a base model, and pick an SFT dataset to run the experiment. For this experiment, I chose <a href="https://huggingface.co/Qwen/Qwen2.5-0.5B" target="_blank" rel="noopener noreferrer">Qwen/Qwen2.5-0.5B</a> as the base model for its compact size, and <a href="https://huggingface.co/datasets/BAAI/Infinity-Instruct" target="_blank" rel="noopener noreferrer">BAAI/Infinity-Instruct</a> as the SFT dataset (somehow randomly ğŸ˜Œ). You can explore other interesting datasets here: <a href="https://github.com/mlabonne/llm-datasets" target="_blank" rel="noopener noreferrer">https://github.com/mlabonne/llm-datasets</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="command-line-arguments">Command-line Arguments<a href="https://edwardzjl.github.io/distributed-sft-part-1#command-line-arguments" class="hash-link" aria-label="Command-line Argumentsçš„ç›´æ¥é“¾æ¥" title="Command-line Argumentsçš„ç›´æ¥é“¾æ¥">â€‹</a></h3>
<p>The training script (<code>sft.py</code>) exposes a variety of useful command-line arguments that allow you to customize the fine-tuning process. These arguments are mapped to specific properties in the following classes:</p>
<ul>
<li><a href="https://huggingface.co/docs/trl/v0.13.0/en/script_utils#trl.ScriptArguments" target="_blank" rel="noopener noreferrer">ScriptArguments</a></li>
<li><a href="https://github.com/huggingface/trl/blob/v0.13.0/trl/trainer/model_config.py#L20" target="_blank" rel="noopener noreferrer">ModelConfig</a></li>
<li><a href="https://huggingface.co/docs/trl/v0.13.0/en/sft_trainer#trl.SFTConfig" target="_blank" rel="noopener noreferrer">SFTConfig</a>, which extends <a href="https://huggingface.co/docs/transformers/en/main_classes/trainer#transformers.TrainingArguments" target="_blank" rel="noopener noreferrer">TrainingArguments</a></li>
</ul>
<p>You can pass any of these arguments directly from the command line by prepending them with <code>--</code>. For instance, passing <code>--dataset_name</code> will set the <code>dataset_name</code> field in the <code>trl.ScriptArguments</code> class.</p>
<p>Let's take a look at the arguments used for this tutorial:</p>
<ul>
<li><code>--model_name_or_path</code>: Specifies the base model to fine-tune.</li>
<li><code>--dataset_name</code>: Defines the dataset to use for fine-tuning.</li>
<li><code>--dataset_config</code>: Some datasets come with multiple configurations (versions). This argument lets you choose the version you want to use.</li>
<li><code>--do_train</code>: Tells the script to start the training process.</li>
<li><code>--per_device_train_batch_size</code>: Defines the batch size for each GPU.</li>
<li><code>--output_dir</code>: Specifies the directory where the model will be saved.</li>
<li><code>--max_steps</code>: Sets the maximum number of training steps.</li>
<li><code>--logging_steps</code>: Sets how often logs are recorded during training.</li>
</ul>
<p>For convenience, I prefer to save the full command in a shell script for easy execution. Here's the script I used for this tutorial:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python sft.py \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --model_name_or_path Qwen/Qwen2.5-0.5B \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --dataset_name BAAI/Infinity-Instruct \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --dataset_config 0625 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --do_train \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --per_device_train_batch_size 4 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --output_dir /tmp/my-first-sft-exp \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --max_steps 10 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --logging_steps 1</span><br></span></code></pre></div></div>
<p>Notes:</p>
<ul>
<li>I selected the smallest version of the dataset and limited the experiment to just 10 steps for a quicker run.</li>
<li>Since the training is only 10 steps, I set <code>--logging_steps</code> to 1 to see logs more frequently.</li>
<li>The <code>--per_device_train_batch_size</code> is set to 4, as the goal here isn't model quality but simply to run the experiment without CUDA OOM. Any number that can fit in your VRAM should work.</li>
</ul>
<blockquote>
<p><em>Updated 2025-02-18:</em></p>
<p><code>trl</code> provides a convenient helper function to parse training args from a YAML file, you can find more details <a href="https://huggingface.co/docs/trl/main/script_utils#trl.TrlParser.parse_args_and_config" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>With this feature, you can save the above training arguments in a YAML file (e.g., <code>recipe.yaml</code>) as follows:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">model_name_or_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Qwen/Qwen2.5</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">0.5B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">dataset_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> BAAI/Infinity</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Instruct</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">dataset_config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'0625'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">do_train</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">per_device_train_batch_size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">output_dir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /tmp/my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">first</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sft</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">exp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">max_steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">logging_steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre></div></div>
<p>And launch the training with:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python sft.py --config recipe.yaml</span><br></span></code></pre></div></div>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-oops">The Oops<a href="https://edwardzjl.github.io/distributed-sft-part-1#the-oops" class="hash-link" aria-label="The Oopsçš„ç›´æ¥é“¾æ¥" title="The Oopsçš„ç›´æ¥é“¾æ¥">â€‹</a></h3>
<p>Now if you use the same dataset and execute the same script, you'll likely encounter a (not so helpful) error message:</p>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./quickstart.sh </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Resolving data files: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 35/35 [00:00&lt;00:00, 50.35it/s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Map:   0%|                                                                                                                                                                         | 0/659808 [00:00&lt;?, ? examples/s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Traceback (most recent call last):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File "/home/jovyan/sft-walkthrough/sft.py", line 126, in &lt;module&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main(script_args, training_args, model_args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File "/home/jovyan/sft-walkthrough/sft.py", line 97, in main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trainer = SFTTrainer(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File "/home/jovyan/.local/lib/python3.10/site-packages/trl/trainer/sft_trainer.py", line 416, in tokenize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    element[dataset_text_field] if formatting_func is None else formatting_func(element),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File "/home/jovyan/.local/lib/python3.10/site-packages/datasets/formatting/formatting.py", line 277, in __getitem__</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value = self.data[key]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KeyError: 'text'</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-fix">The Fix<a href="https://edwardzjl.github.io/distributed-sft-part-1#the-fix" class="hash-link" aria-label="The Fixçš„ç›´æ¥é“¾æ¥" title="The Fixçš„ç›´æ¥é“¾æ¥">â€‹</a></h3>
<blockquote>
<p><em>Updated 2025-02-18:</em></p>
<ul>
<li>Starting from trl 0.15.0 (in <a href="https://github.com/huggingface/trl/pull/2405" target="_blank" rel="noopener noreferrer">this PR</a>) the 'conversations' column is no longer supported. We need to rename it to 'messages'.</li>
<li>In <a href="https://github.com/huggingface/trl/pull/2862" target="_blank" rel="noopener noreferrer">this PR</a> (not yet released as of writing), support for the 'conversations' column is back and the whole preprocessing is simplified, we no longer need to map the dict keys('from' -&gt; 'role', 'value' -&gt; 'content') ourselves.</li>
</ul>
<p><em>Updated 2025-02-19:</em></p>
<p>The above PR is released in trl 0.15.1.</p>
</blockquote>
<p>This error message is a bit confusing--it states that the <code>SFTTrainer</code> requires the dataset to have a 'text' field. However, according to the <a href="https://huggingface.co/docs/trl/dataset_formats#overview-of-the-dataset-formats-and-types" target="_blank" rel="noopener noreferrer">dataset format and types</a>, 'text' is used for standard dataset, while 'messages' should be used for conversational datasets. After a lot of googling, I came across <a href="https://github.com/huggingface/trl/issues/2071" target="_blank" rel="noopener noreferrer">this tracking issue</a>, <a href="https://github.com/huggingface/trl/blob/v0.13.0/trl/trainer/sft_trainer.py#L250" target="_blank" rel="noopener noreferrer">this line of code</a> and <a href="https://github.com/huggingface/trl/blob/v0.13.0/trl/extras/dataset_formatting.py#L78" target="_blank" rel="noopener noreferrer">this function</a>. It seems that for the current implementation (<code>trl == 0.13.0</code>) we have two options:</p>
<ol>
<li>Format the dataset ourselves (apply a chat template) and place the formatted data into the 'text' field.</li>
<li>Convert our dataset in a way that allows <code>trl</code> to handle the transformation for us.</li>
</ol>
<p>For the second option to work, the dataset must:</p>
<ul>
<li>Contain a 'messages' or 'conversations' field.</li>
<li>Have each element in the 'messages' (or 'conversations') field include both a 'content' field and a 'role' field.</li>
</ul>
<p>Examining the dataset I used revealed a mismatch: while it has a 'conversations' field, the elements inside use 'from' and 'value' as keys instead of 'role' and 'content'. As a lazy coder, I opted for the second approach and updated the training script accordingly. Additionally, I also remove all other fields in the dataset, as they are unused for the SFT task. Removing them will slightly reduce memory footprint and speed up processing.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">script_args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> training_args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> model_args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Dataset</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> load_dataset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">script_args</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dataset_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">script_args</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dataset_config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">convert_fields</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _message </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">"role"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"from"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">"content"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"value"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Qwen2.5 tokenizer only supports "system", "user", "assistant" and "tool"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># See &lt;https://huggingface.co/Qwen/Qwen2.5-3B/blob/main/tokenizer_config.json#L198&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> _message</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"role"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"human"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _message</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"role"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"user"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> _message</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"role"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"gpt"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _message</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"role"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"assistant"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> _message</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"role"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"system"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># nothing to be done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># In case there are any other roles, print them so we can improve in next iteration.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_message</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"role"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> _message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">convert_messages</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        example</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"conversations"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">convert_fields</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> message </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"conversations"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># remove unused fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dataset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">remove_columns</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"id"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"label"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"langdetect"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"source"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">convert_messages</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<p>With that update, the script ran without any issues! You should be able to see the training log like:</p>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./quickstart.sh </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Resolving data files: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 35/35 [00:02&lt;00:00, 17.26it/s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Map: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 659808/659808 [01:19&lt;00:00, 8280.44 examples/s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Map: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 659808/659808 [08:33&lt;00:00, 1284.45 examples/s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{'loss': 1.8859, 'grad_norm': 14.986075401306152, 'learning_rate': 1.8e-05, 'epoch': 0.0}                                                                                                                                     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{'loss': 1.4527, 'grad_norm': 13.9092378616333, 'learning_rate': 1.6000000000000003e-05, 'epoch': 0.0}                                                                                                                        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{'loss': 1.467, 'grad_norm': 7.388503074645996, 'learning_rate': 1.4e-05, 'epoch': 0.0}                                                                                                                                       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{'loss': 1.7757, 'grad_norm': 9.457520484924316, 'learning_rate': 1.2e-05, 'epoch': 0.0}                                                                                                                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{'loss': 1.9043, 'grad_norm': 10.256357192993164, 'learning_rate': 1e-05, 'epoch': 0.0}                                                                                                                                       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{'loss': 1.6163, 'grad_norm': 10.774249076843262, 'learning_rate': 8.000000000000001e-06, 'epoch': 0.0}                                                                                                                       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{'loss': 1.1774, 'grad_norm': 5.897563457489014, 'learning_rate': 6e-06, 'epoch': 0.0}                                                                                                                                        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{'loss': 1.8093, 'grad_norm': 8.3130464553833, 'learning_rate': 4.000000000000001e-06, 'epoch': 0.0}                                                                                                                          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{'loss': 1.8387, 'grad_norm': 7.102719306945801, 'learning_rate': 2.0000000000000003e-06, 'epoch': 0.0}                                                                                                                       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{'loss': 1.4251, 'grad_norm': 9.853829383850098, 'learning_rate': 0.0, 'epoch': 0.0}                                                                                                                                          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{'train_runtime': 38.8598, 'train_samples_per_second': 1.029, 'train_steps_per_second': 0.257, 'train_loss': 1.635251808166504, 'epoch': 0.0}                                                                                 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 10/10 [00:38&lt;00:00,  3.89s/it]</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://edwardzjl.github.io/distributed-sft-part-1#conclusion" class="hash-link" aria-label="Conclusionçš„ç›´æ¥é“¾æ¥" title="Conclusionçš„ç›´æ¥é“¾æ¥">â€‹</a></h2>
<p>In this first part, we've walked through setting up a local SFT experiment using <code>trl</code>. This library provides a user-friendly interface for fine-tuning LLMs with custom datasets. We also covered the correct dataset format required for <code>trl</code>'s <code>SFTTrainer</code> and how to preprocess datasets to meet these requirements.</p>
<p>In the next part, we'll delve into scaling this setup locally using a single-node, multi-GPU configuration to tackle a complete SFT task. Additionally, we'll explore various optimization techniques to fit a bigger model into your GPU and accelerate the training process. Stay tuned!</p>]]></content>
        <author>
            <name>Junlin Zhou</name>
            <uri>https://github.com/edwardzjl</uri>
        </author>
        <category label="LLM" term="LLM"/>
        <category label="distributed-training" term="distributed-training"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[<è¯‘>JSONæ ¼å¼ä½œä¸ºé…ç½®æ–‡ä»¶çš„ç¼ºç‚¹]]></title>
        <id>https://edwardzjl.github.io/the-downsides-of-json-for-config-files</id>
        <link href="https://edwardzjl.github.io/the-downsides-of-json-for-config-files"/>
        <updated>2019-08-09T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[ç¿»è¯‘è‡ªè¿™ç¯‡æ–‡ç« ]]></summary>
        <content type="html"><![CDATA[<p>ç¿»è¯‘è‡ª<a href="https://www.arp242.net/json-config.html" target="_blank" rel="noopener noreferrer" title="The downsides of JSON for config files">è¿™ç¯‡æ–‡ç« </a></p>
<p>æˆ‘æœ€è¿‘æ¥è§¦åˆ°è®¸å¤šé¡¹ç›®å°† <code>JSON</code> ç”¨ä½œé…ç½®æ–‡ä»¶ã€‚æˆ‘è®¤ä¸ºè¿™ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚</p>
<p><code>JSON</code> ä»è®¾è®¡ä¹‹åˆå°±ä¸æ˜¯ç”¨äºåšé…ç½®æ–‡ä»¶çš„ï¼Œè¿™ä¹Ÿä¸æ˜¯å®ƒæ“…é•¿çš„é¢†åŸŸã€‚<code>JSON</code> çš„ç›®æ ‡æ˜¯ "è½»é‡çº§æ•°æ®äº¤æ¢æ ¼å¼", åŒæ—¶å…·æœ‰ "æ˜“äºäººç±»è¯»å†™", "æ˜“äºä»£ç è§£æå’Œç”Ÿæˆ" çš„ç‰¹ç‚¹ã€‚å®ƒåœ¨å¯¹ "äººç±»è€Œè¨€çš„ä¾¿åˆ©æ€§" å’Œ "å¯¹æœºå™¨è€Œè¨€çš„ä¾¿åˆ©æ€§" ä¹‹é—´å–å¾—äº†è¾ƒå¥½çš„å¹³è¡¡, åœ¨è®¸å¤šåº”ç”¨åœºæ™¯ä¸‹éƒ½æ˜¯æ¯” <code>XML</code> æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆã€‚</p>
<p>ç„¶è€Œï¼Œå°† <code>JSON</code> ç”¨äºå…¶ä»–ç›®çš„æœ‰ç‚¹ç±»ä¼¼äºè¯´ "å˜¿ï¼Œè¿™æŠŠé”¤å­éå¸¸é€‚åˆé’‰é’‰å­ï¼æˆ‘å–œæ¬¢å®ƒï¼ä¸ºä»€ä¹ˆä¸ç”¨å®ƒæ¥æ‹§èºä¸ï¼" å½“ç„¶å®ƒä¸æ˜¯å®Œå…¨ä¸èƒ½ç”¨ï¼Œåªæ˜¯ä¸åˆé€‚åšè¿™æ ·çš„å·¥ä½œã€‚</p>
<p>ç›®å‰ä¸ºæ­¢ï¼Œå°† <code>JSON</code> ç”¨ä½œå…¶å®ƒç”¨é€”æœ€å¤§çš„é—®é¢˜åœ¨äºä¸èƒ½åœ¨ <code>JSON</code> æ–‡ä»¶ä¸­æ·»åŠ æ³¨é‡Šã€‚æŸäº›ç‰¹å®šçš„ <code>JSON</code> è§£æå™¨æ”¯æŒåœ¨ <code>JSON</code> ä¸­æ·»åŠ æ³¨é‡Šï¼Œä½†æ˜¯ç»å¤§éƒ¨åˆ†çš„è§£æå™¨éƒ½ä¸æ”¯æŒã€‚<code>JSON</code> çš„å‘æ˜è€… <code>Douglas Crockford</code> å£°ç§° <code>JSON</code> æœ€å¼€å§‹æ˜¯æ”¯æŒæ³¨é‡Šçš„ï¼Œç„¶è€Œç”±äºä¸€äº›åŸå› ï¼Œä»–ç‰¹æ„ç§»é™¤äº†å¯¹æ³¨é‡Šçš„æ”¯æŒã€‚æƒ³è¦æ·±å…¥ç ”ç©¶çš„æœ‹å‹å¯ä»¥çœ‹<a href="https://vorba.ch/2013/json-comments.html" target="_blank" rel="noopener noreferrer" title="Why are comments not allowed in JSON?">è¿™é‡Œ</a>ã€‚</p>
<p>æˆ‘ä»¬åœ¨å†™é…ç½®æ–‡ä»¶æ—¶ç»å¸¸ä¼šé‡åˆ°éœ€è¦æ·»åŠ æ³¨é‡Šçš„åœºæ™¯ã€‚ä¾‹å¦‚è§£é‡Šä¸ºä»€ä¹ˆå°†é…ç½®é¡¹è®¾ç½®ä¸ºå½“å‰çš„å€¼ï¼Œæ·»åŠ ä¸€äº›åŠ©è®°ç¬¦æˆ–æ˜¯æ³¨æ„äº‹é¡¹ï¼Œå¯¹äºé”™è¯¯é…ç½®çš„è­¦å‘Šï¼Œåœ¨æ–‡ä»¶ä¸­ä¿å­˜ä¸€ä»½åŸºç¡€çš„ <code>changelog</code>ï¼Œåˆæˆ–å•çº¯æ˜¯åœ¨debugæ—¶éœ€è¦æ³¨é‡Šæ‰ä¸€äº›é…ç½®é¡¹ã€‚</p>
<p>ä¸€ä¸ªå¯è¡Œçš„è§£å†³æ–¹æ³•æ˜¯å°†åŸæœ¬çš„æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ª object ä¸­ï¼Œåœ¨è¿™ä¸ª object ä¸­é€šè¿‡ä¸¤ä¸ªæ¡ç›®åˆ†åˆ«å­˜å‚¨æ•°æ®å’Œæ³¨é‡Šã€‚ä¾‹å¦‚åŸæœ¬çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"config_name"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"config_value"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>ä¿®æ”¹åå˜æˆå¦‚ä¸‹å½¢å¼:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"config_name"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	  </span><span class="token property" style="color:#36acaa">"actual_data"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"config_value"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">"comment"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"a comment"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>ä½†æ˜¯åœ¨æˆ‘çœ‹æ¥è¿™ç§æ–¹å¼ä¸‘çš„å‹æ‰¹ã€‚</p>
<p>è¿˜æœ‰ä¸€äº›äººæŒ‡å‡ºå¯ä»¥é€šè¿‡ commit log çš„å½¢å¼æ¥å®ç°æ³¨é‡Š <em>ï¼ˆè¯‘è€…ï¼šä¸æ¸…æ¥šä»–è¿™é‡ŒæŒ‡çš„æ˜¯ä¸æ˜¯ git commit logï¼Œå¦‚æœæ˜¯çš„è¯æŠŠè¿™ä¸ªå½“ä½œæ³¨é‡Šæ–¹å¼å¥½åƒååˆ†éš¾ç”¨å§ï¼Ÿï¼‰</em>ï¼Œä½†æ˜¯åˆæœ‰å‡ ä¸ªäººä¼šå»ç»†è¯» commit historyï¼Ÿ</p>
<p>ä¸€äº›åŸºäº <code>JSON</code> è¿›è¡Œæ‰©å±•çš„æ ¼å¼ï¼Œä¾‹å¦‚ <code>JSON5</code>ï¼Œ<code>Hjson</code> å’Œ <code>HOCON</code>ï¼Œä»¥åŠä¸€å°éƒ¨åˆ† <code>JSON</code> è§£æå™¨æ·»åŠ äº†å¯¹æ³¨é‡Šçš„æ”¯æŒã€‚è¿™å¾ˆå®ç”¨ï¼Œä½†è¿™äº›éƒ½å±äº <code>JSON</code> çš„å˜ç§ï¼Œå› æ­¤ä¸åœ¨æœ¬ç¯‡çš„è®¨è®ºèŒƒå›´ä¹‹å†…ã€‚</p>
<p>åŒæ—¶æˆ‘ä¹Ÿå‘ç°æ‰‹å·¥ç¼–è¾‘ <code>JSON</code> çš„ç”¨æˆ·ä½“éªŒä¸æ˜¯é‚£ä¹ˆå‹å¥½ï¼šä½ å¾—ç•™æ„è¡Œå°¾æ˜¯å¦è¦æ·»åŠ é€—å·ï¼Œå¾—äº†è§£ç”¨ä¸ç”¨å¼•å·å¯¹å«ä¹‰çš„å½±å“ï¼ŒåŒæ—¶ <code>JSON</code> ä¹Ÿä¸æ”¯æŒå­—ç¬¦ä¸²å†…æ¢è¡Œã€‚è¿™äº›ç‰¹æ€§å¯¹äº "è½»é‡çº§æ•°æ®äº¤æ¢æ ¼å¼" è€Œè¨€ä¸æ˜¯åäº‹ï¼Œä½†æ˜¯å¯¹äºç¼–è¾‘é…ç½®æ–‡ä»¶è¿™ä»¶äº‹æ¥è¯´å´ä¸æ˜¯é‚£ä¹ˆå¯çˆ±ã€‚æ€»çš„æ¥è¯´ï¼Œå°† <code>JSON</code> ç”¨ä½œé…ç½®æ–‡ä»¶è™½ç„¶å¯è¡Œï¼Œä½†å¹¶ä¸ä¼˜é›…ã€‚</p>
<p>MediaWiki çš„æ–°æ‰©å±•ç³»ç»Ÿä¿ƒä½¿æˆ‘å†™ä¸‹è¿™ç¯‡æ–‡ç« ã€‚æ—§çš„ç³»ç»Ÿé€šè¿‡ PHP æ–‡ä»¶æ¥æŒ‚æ¥æ ¸å¿ƒä»£ç ï¼ŒåŠ è½½æ‰€éœ€çš„ä¾èµ–é¡¹ç­‰ã€‚æ–°ç³»ç»Ÿé€šè¿‡ JSON æ–‡ä»¶å®ç°è¿™äº›é…ç½®ã€‚è¿™æ ·çš„æ›´æ–°æŸå¤±äº† PHP é‚£ç§èƒ½å¤Ÿå·§å¦™è§£å†³ä¸å…¶ä»–æ’ä»¶å…¼å®¹æ€§çš„èƒ½åŠ›ã€‚ <em>ï¼ˆè¿™æ®µæ²¡çœ‹æ‡‚ï¼‰</em></p>
<p>åŒæ—¶å®ƒä¹Ÿå¸¦æ¥äº†æ›´å¤šå®ç°å¤æ‚åº¦ã€‚æ—§çš„ç³»ç»Ÿåœ¨å¼•å…¥é…ç½®æ–‡ä»¶æ—¶ä»…ä»…éœ€è¦ä¸€è¡Œä»£ç ï¼š</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'plugin/foo/plugin.php'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>è€Œæ–°ç³»ç»Ÿå´éœ€è¦å¯¹ JSON æ–‡ä»¶çš„å†…å®¹è¿›è¡Œè§£æã€‚è¿™åœ¨æå‡å®ç°å¤æ‚åº¦çš„åŒæ—¶ï¼Œä¹Ÿæé«˜äº† debug çš„éš¾åº¦ã€‚
<em>ï¼ˆè¿™æ®µä¸å¤ªèµåŒï¼ŒXML ä½œä¸ºé…ç½®æ–‡ä»¶ï¼ŒåŒæ ·è¦è¿›è¡Œè§£æï¼Œè¿™ä¸æ˜¯ JSON çš„é—®é¢˜ã€‚ï¼‰</em></p>
<p>ä½¿ç”¨ JSON æ–‡ä»¶å­˜å‚¨åŸºæœ¬å…ƒæ•°æ®æ˜¯å¯è¡Œçš„ï¼ˆæ›´å®¹æ˜“è§£æä»¥åŠåœ¨ç½‘ç«™ä¸Šæ˜¾ç¤ºï¼‰ï¼Œä½†ä½¿ç”¨å®ƒæ¥æè¿°ä»£ç çš„å·¥ä½œæ–¹å¼å¯¹æˆ‘æ¥è¯´æ˜¯æ»¥ç”¨ DCï¼ˆDeclarative configuration ï¼Œå£°æ˜æ€§é…ç½®ï¼‰ã€‚æ¯•ç«Ÿï¼Œè¿™æ˜¯ä»£ç çš„å·¥ä½œã€‚</p>
<p>è®¸å¤šäººé—®æˆ‘é‚£åˆ°åº•è¯¥ç”¨ä»€ä¹ˆ(æ¥åšé…ç½®æ–‡ä»¶)ï¼Œè¿™å…¶å®æ˜¯ä¸ªå¾ˆå¤æ‚çš„é—®é¢˜ï¼Œå…³ç³»åˆ°ä½ ç¨‹åºçš„åº”ç”¨åœºæ™¯ã€ç¼–ç¨‹è¯­è¨€ã€åº“ç¯å¢ƒç”šè‡³ä¸€äº›ç¤¾äº¤å› ç´ ï¼ˆï¼Ÿï¼‰ã€‚æœ€å¥½çš„å›ç­”å¯èƒ½å°±æ˜¯â€œæ‰¾åˆ°èƒ½ç¬¦åˆä½ éœ€æ±‚çš„æœ€ç®€å•çš„æ–¹æ¡ˆâ€ã€‚</p>
<p>æœ‰ä¸€äº› JSON çš„æ‰©å±•æ ¼å¼æ›´é€‚åˆäºäººç±»è¿›è¡Œç¼–è¾‘ï¼Œä¾‹å¦‚ JSON5ã€Hjson å’Œ HOCONã€‚è¿™äº›çœ‹èµ·æ¥éƒ½æ˜¯æ™®é€šJSONçš„åˆç†å‡çº§ï¼Œå°½ç®¡æˆ‘è‡ªå·±æ²¡æœ‰ä½¿ç”¨è¿‡å®ƒä»¬ã€‚ç‰¹åˆ«æ˜¯ JSON5 ä¼¼ä¹æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒå¯¹ JSON çš„æ”¹åŠ¨æœ€å°‘ã€‚æˆ‘ä¸èƒ½ç»™å‡ºå…³äºè¿™äº›æ‰©å±•æ ¼å¼çš„å»ºè®®ï¼Œå› ä¸ºæˆ‘æ²¡æœ‰æ‰€æœ‰çš„æ ¼å¼è¿›è¡Œæ·±å…¥çš„æ¯”è¾ƒã€‚åªæ˜¯çœ‹ä¸€çœ¼æ ¼å¼è§„èŒƒå¹¶ä¸èƒ½å‘ç°æ½œåœ¨çš„ç¼ºç‚¹ï¼ˆYAML å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼‰ã€‚æˆ‘æ²¡æœ‰æ—¶é—´æˆ–æ˜¯å…´è¶£å¯¹æ‰€æœ‰æ›¿ä»£æ–¹æ¡ˆè¿›è¡Œå…¨é¢æ·±å…¥çš„å®¡æŸ¥ã€‚</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="åè®°">åè®°<a href="https://edwardzjl.github.io/the-downsides-of-json-for-config-files#%E5%90%8E%E8%AE%B0" class="hash-link" aria-label="åè®°çš„ç›´æ¥é“¾æ¥" title="åè®°çš„ç›´æ¥é“¾æ¥">â€‹</a></h2>
<p>è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡åšéœ€è¦å‘å¸ƒåˆ°ç½‘ä¸Šçš„æ¯”è¾ƒæ­£å¼çš„ç¿»è¯‘å·¥ä½œã€‚è™½ç„¶æœ€æ—©è‡ªå·±åœ¨è¯» paper çš„æ—¶å€™å› ä¸ºè‹±è¯­ç”Ÿç–ï¼Œä¹Ÿä¼šè¾¹è¯»è¾¹ç¿»è¯‘ä¸€äº›ï¼Œä½†æ˜¯æ¯•ç«Ÿé‚£æ˜¯ç¿»è¯‘ç»™è‡ªå·±çœ‹çš„ï¼Œåªè¦è‡ªå·±èƒ½çœ‹æ‡‚å°±è¡Œäº†ï¼Œä¹Ÿä¸ç”¨è¿½æ±‚ä»€ä¹ˆè¯­å¥é€šé¡ºä¹‹ç±»çš„ã€‚ç„¶è€Œè¦å‘å¸ƒå‡ºæ¥çš„æ–‡ç« ä¸ä¸€æ ·ï¼Œè‡³å°‘è¦ä¿è¯å¤§å¤šæ•°è¯»è€…èƒ½å¤Ÿçœ‹å¾—æ‡‚ã€‚</p>
<p>æ•´ç¯‡ç¿»å®Œå›è¿‡å¤´çœ‹çœ‹ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šç”Ÿç¡¬ä¼¼æœºç¿»çš„åœ°æ–¹ï¼Œä¸»è¦åŸå› å¯èƒ½è¿˜æ˜¯è‡ªå·±çš„è¡¨è¾¾èƒ½åŠ›ä¸å¤Ÿã€‚ç¿»è¯‘æŠ€æœ¯æ–‡ç« åœ¨æˆ‘çœ‹æ¥æ˜¯ä¸ªåƒåŠ›ä¸è®¨å¥½çš„æ´»ï¼Œç¿»çš„å†å¥½ä¹Ÿä¸å¦‚ç›´æ¥è¯»åŸæ–‡æ¥çš„æ¸…æ™°ã€‚è‡³äºä¸ºä»€ä¹ˆè¦åšè¿™æ ·çš„äº‹æƒ…ï¼Œ æˆ‘æƒ³æœ‰æ—¶é—´å•ç‹¬å†™ä¸€ç¯‡è°ˆä¸€è°ˆã€‚ç›®å‰æ¥çœ‹ï¼Œå°±æƒå½“æ˜¯å¯¹äºè‡ªå·±è¡¨è¾¾èƒ½åŠ›çš„é”»ç‚¼å§ã€‚</p>]]></content>
        <author>
            <name>Junlin Zhou</name>
            <uri>https://github.com/edwardzjl</uri>
        </author>
        <category label="json" term="json"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç³»ç»Ÿä¸­çŠ¶æ€ä¸º static çš„æœåŠ¡]]></title>
        <id>https://edwardzjl.github.io/static-service</id>
        <link href="https://edwardzjl.github.io/static-service"/>
        <updated>2019-07-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[æœ€è¿‘å¼€å§‹æ¥è§¦ Linux è¿ç»´çš„å·¥ä½œï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯çœ‹çœ‹ç³»ç»Ÿä¸­è·‘äº†å¤šå°‘æœåŠ¡ã€‚]]></summary>
        <content type="html"><![CDATA[<p>æœ€è¿‘å¼€å§‹æ¥è§¦ Linux è¿ç»´çš„å·¥ä½œï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯çœ‹çœ‹ç³»ç»Ÿä¸­è·‘äº†å¤šå°‘æœåŠ¡ã€‚</p>
<p>é›†ç¾¤ç”¨çš„æ˜¯ CentOS 7ï¼Œå¯ä»¥é€šè¿‡ <code>bash systemctl list-unit-files</code> è¿™ä¸ªå‘½ä»¤æŸ¥çœ‹æ‰€æœ‰æœåŠ¡ï¼Œæ•²ä¸‹å›è½¦åæ‰“å°å‡ºæ¥è¿™ä¹ˆä¸€å †ç©åº”å„¿ï¼š</p>
<p><img decoding="async" loading="lazy" alt="services" src="https://edwardzjl.github.io/assets/images/services-1f32b5744640cabbd42f360a89b1bffb.png" title="services" width="454" height="474" class="img_ev3q"></p>
<p>service çš„ <code>disabled</code> å’Œ <code>enabled</code> çŠ¶æ€éƒ½å¥½ç†è§£ï¼Œ<code>static</code> æ˜¯ä¸ªå•¥ï¼Ÿåœ¨<a href="https://bbs.archlinux.org/viewtopic.php?id=147964" target="_blank" rel="noopener noreferrer" title="systemd 'static' unit file state">ä¸å­˜åœ¨çš„ç½‘ç«™</a>ä¸Šä¸€é¡¿æŸ¥æ‰¾ï¼Œæ‰¾åˆ°å¦‚ä¸‹è¿™ç•ªè§£é‡Šï¼š</p>
<blockquote>
<p>"static" means "enabled because something else wants it". Think by analogy to pacman's package install reasons:</p>
<ul>
<li>enabled :: explicitly installed</li>
<li>static :: installed as dependency</li>
<li>disabled :: not installed</li>
</ul>
</blockquote>
<p>æ„æ€æ˜¯ï¼ŒçŠ¶æ€ä¸º <code>static</code> çš„æœåŠ¡ï¼Œæ˜¯ä½œä¸ºåˆ«çš„æœåŠ¡çš„ä¾èµ–è€Œå­˜åœ¨ã€‚</p>]]></content>
        <author>
            <name>Junlin Zhou</name>
            <uri>https://github.com/edwardzjl</uri>
        </author>
        <category label="linux" term="linux"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[<è¯‘> javax.persistence.Id å’Œ org.springframework.data.annotation.Id çš„åŒºåˆ«]]></title>
        <id>https://edwardzjl.github.io/difference-between-javax.persistence.id-and-org.springframework.data.annotation.id</id>
        <link href="https://edwardzjl.github.io/difference-between-javax.persistence.id-and-org.springframework.data.annotation.id"/>
        <updated>2019-06-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[org.springframework.data.annotation.Id]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="orgspringframeworkdataannotationid">org.springframework.data.annotation.Id<a href="https://edwardzjl.github.io/difference-between-javax.persistence.id-and-org.springframework.data.annotation.id#orgspringframeworkdataannotationid" class="hash-link" aria-label="org.springframework.data.annotation.Idçš„ç›´æ¥é“¾æ¥" title="org.springframework.data.annotation.Idçš„ç›´æ¥é“¾æ¥">â€‹</a></h2>
<p><code>org.springframework.data.annotation.Id</code> æ˜¯ Spring å®šä¹‰çš„ annotationï¼Œç”¨æ¥æ”¯æŒ "æ²¡æœ‰åƒ JPA é‚£æ ·çš„æŒä¹…åŒ– API" çš„éå…³ç³»å‹æ•°æ®åº“æˆ–æ˜¯æ¡†æ¶çš„æŒä¹…åŒ–ï¼Œå› æ­¤å®ƒå¸¸è¢«ç”¨äºå…¶å®ƒ spring-data é¡¹ç›®ï¼Œä¾‹å¦‚ spring-data-mongodb å’Œ spring-data-solr ç­‰ã€‚</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="javaxpersistenceid">javax.persistence.Id<a href="https://edwardzjl.github.io/difference-between-javax.persistence.id-and-org.springframework.data.annotation.id#javaxpersistenceid" class="hash-link" aria-label="javax.persistence.Idçš„ç›´æ¥é“¾æ¥" title="javax.persistence.Idçš„ç›´æ¥é“¾æ¥">â€‹</a></h2>
<p><code>javax.persistence.Id</code> æ˜¯ç”± JPA å®šä¹‰çš„ annotationï¼ŒJPA ä»…é€‚ç”¨äºå…³ç³»æ•°æ®çš„ç®¡ç†ã€‚</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ref">Ref<a href="https://edwardzjl.github.io/difference-between-javax.persistence.id-and-org.springframework.data.annotation.id#ref" class="hash-link" aria-label="Refçš„ç›´æ¥é“¾æ¥" title="Refçš„ç›´æ¥é“¾æ¥">â€‹</a></h2>
<ul>
<li><a href="https://stackoverflow.com/questions/39643960/whats-the-difference-between-javax-persistence-id-and-org-springframework-data" target="_blank" rel="noopener noreferrer">whats-the-difference-between-javax-persistence-id-and-org-springframework-data</a></li>
</ul>]]></content>
        <author>
            <name>Junlin Zhou</name>
            <uri>https://github.com/edwardzjl</uri>
        </author>
        <category label="spring" term="spring"/>
        <category label="java" term="java"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Install postgres on OSX]]></title>
        <id>https://edwardzjl.github.io/install-postgres-on-osx</id>
        <link href="https://edwardzjl.github.io/install-postgres-on-osx"/>
        <updated>2019-04-13T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[If you installed Postgres from homebrew, the default user postgres isn't automatically created, you need to run following command in your terminal:]]></summary>
        <content type="html"><![CDATA[<p>If you installed Postgres from homebrew, the default user <code>postgres</code> isn't automatically created, you need to run following command in your terminal:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/Applications/Postgres.app/Contents/Versions/9.*/bin/createuser -s postgres</span><br></span></code></pre></div></div>]]></content>
        <author>
            <name>Junlin Zhou</name>
            <uri>https://github.com/edwardzjl</uri>
        </author>
        <category label="postgres" term="postgres"/>
        <category label="osx" term="osx"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Ubuntu / CentOS ç¼–è¯‘å®‰è£…å¸¦å‰ªè´´æ¿æ”¯æŒçš„ Vim]]></title>
        <id>https://edwardzjl.github.io/config-vim-8-clipboard</id>
        <link href="https://edwardzjl.github.io/config-vim-8-clipboard"/>
        <updated>2019-03-14T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[é€šè¿‡ Ubuntu æˆ– CentOS ç³»ç»Ÿè‡ªå¸¦çš„è½¯ä»¶æºå®‰è£… Vimï¼Œå¾€å¾€åªèƒ½å¾—åˆ°è¾ƒæ—§çš„ç‰ˆæœ¬ï¼ˆé€šå¸¸æ˜¯ 7.4.xï¼‰ã€‚è€Œä» Vim 8.0 å¼€å§‹ï¼Œå®˜ç½‘æ¨èçš„å®‰è£…æ–¹å¼æ˜¯é€šè¿‡ Git å…‹éš†æºç è‡ªè¡Œç¼–è¯‘ã€‚]]></summary>
        <content type="html"><![CDATA[<p>é€šè¿‡ Ubuntu æˆ– CentOS ç³»ç»Ÿè‡ªå¸¦çš„è½¯ä»¶æºå®‰è£… Vimï¼Œå¾€å¾€åªèƒ½å¾—åˆ°è¾ƒæ—§çš„ç‰ˆæœ¬ï¼ˆé€šå¸¸æ˜¯ 7.4.xï¼‰ã€‚è€Œä» Vim 8.0 å¼€å§‹ï¼Œå®˜ç½‘æ¨èçš„å®‰è£…æ–¹å¼æ˜¯é€šè¿‡ Git å…‹éš†æºç è‡ªè¡Œç¼–è¯‘ã€‚</p>
<p>ä¸è¿‡éœ€è¦æ³¨æ„ï¼Œ<strong>é»˜è®¤ç¼–è¯‘å‡ºæ¥çš„ Vim å¹¶ä¸åŒ…å«å‰ªè´´æ¿æ”¯æŒï¼ˆclipboard supportï¼‰</strong>ï¼Œå› æ­¤æ— æ³•ä¸ç³»ç»Ÿå‰ªè´´æ¿äº¤äº’ï¼ˆä¾‹å¦‚å¤åˆ¶ç²˜è´´åˆ°å…¶ä»–ç¨‹åºï¼‰ã€‚</p>
<p>è¦åœ¨ç¼–è¯‘æ—¶å¯ç”¨å‰ªè´´æ¿æ”¯æŒï¼Œè‡³å°‘éœ€è¦ä¸¤ä¸ªä¾èµ–åŒ…ï¼š</p>
<ul>
<li><code>libx11-dev</code>ï¼šæä¾› Xorg çš„å¤´æ–‡ä»¶ï¼ˆxorg header filesï¼‰</li>
<li><code>dbus-x11</code>ï¼šæä¾› X11 çš„ D-Bus æ”¯æŒ</li>
</ul>
<p>ä½ å¯ä»¥åœ¨ <a href="https://packages.ubuntu.com/" target="_blank" rel="noopener noreferrer">https://packages.ubuntu.com</a> æœç´¢å…·ä½“çš„ä¾èµ–é¡¹ä½ç½®ï¼Œæœ€ç»ˆç¡®è®¤è¿™ä¸¤ä¸ªåŒ…å°±æ˜¯æˆ‘ä»¬æ‰€éœ€çš„ã€‚</p>
<p>å®‰è£…ä¾èµ–å¹¶ç¼–è¯‘ Vim çš„å®Œæ•´æµç¨‹å¦‚ä¸‹ï¼š</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get install libx11-dev dbus-x11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/vim/vim.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd vim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./configure --with-features=huge --enable-gui=auto --enable-cscope --prefix=/usr/local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo make install</span><br></span></code></pre></div></div>
<blockquote>
<p>å…¶ä¸­ <code>--with-features=huge</code> å¯ç”¨å‡ ä¹æ‰€æœ‰åŠŸèƒ½ï¼Œ<code>--enable-gui=auto</code> å¯é€‰å¯ç”¨ GUI æ¨¡å¼ï¼ˆå¦‚ gvimï¼‰ï¼Œ<code>--enable-cscope</code> åˆ™ç”¨äºå¢å¼ºä»£ç å¯¼èˆªåŠŸèƒ½ã€‚</p>
</blockquote>
<p>å®‰è£…å®Œæˆåï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>vim --version</code> æ£€æŸ¥æ˜¯å¦å¯ç”¨äº† <code>+clipboard</code>ï¼Œç¡®è®¤å‰ªè´´æ¿æ”¯æŒæ˜¯å¦ç”Ÿæ•ˆã€‚</p>]]></content>
        <author>
            <name>Junlin Zhou</name>
            <uri>https://github.com/edwardzjl</uri>
        </author>
        <category label="vim" term="vim"/>
    </entry>
</feed>